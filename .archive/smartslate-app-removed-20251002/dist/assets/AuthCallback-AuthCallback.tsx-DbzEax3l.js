import{u as l,r as p,j as o}from"./react-vendor-chunk-Ifbrj989.js";import{g as c,a as n}from"./feature-auth-chunk-CXGvZjQd.js";import"./vendor-chunk-DK5fc1G8.js";import"./supabase-chunk-CR9ODFC2.js";import"./pdf-libs-chunk-B1C7EZxo.js";function y(){const r=l();return p.useEffect(()=>{let s=!0;c().auth.getSession().then(({data:{session:a}})=>{if(s&&a){const e=new URLSearchParams(window.location.search).get("redirectTo")||void 0,t=a.user?.email||a.user?.id||"user",i=[];fetch("/api/session/issue"+(e?`?redirectTo=${encodeURIComponent(e)}`:""),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({sub:t,roles:i})}).then(()=>{r(e||n.portal,{replace:!0})}).catch(()=>{r(n.portal,{replace:!0})});return}});const{data:{subscription:u}}=c().auth.onAuthStateChange((a,e)=>{if(e){const t=new URLSearchParams(window.location.search).get("redirectTo")||void 0,i=e.user?.email||e.user?.id||"user",d=[];fetch("/api/session/issue"+(t?`?redirectTo=${encodeURIComponent(t)}`:""),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({sub:i,roles:d})}).finally(()=>{r(t||n.portal,{replace:!0})})}});return()=>{s=!1,u.unsubscribe()}},[r]),o.jsx("div",{className:"min-h-screen w-full flex items-center justify-center p-4 bg-slate-950 text-white",children:o.jsx("div",{className:"opacity-70 animate-fade-in-up",children:"Signing you inâ€¦"})})}export{y as default};
